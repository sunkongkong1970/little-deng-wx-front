# 小程序图片显示配置说明

## 开发环境配置（立即生效）

1. 打开微信开发者工具
2. 点击右上角 **详情**
3. 选择 **本地设置** 标签
4. 勾选以下选项：
   ```
   ✅ 不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书
   ```
5. 保存后刷新小程序

## 生产环境配置（正式发布必需）

### 步骤1：登录微信公众平台
访问：https://mp.weixin.qq.com

### 步骤2：配置服务器域名
1. 进入小程序后台
2. 点击：开发 -> 开发管理 -> 开发设置
3. 找到 **服务器域名** 部分

### 步骤3：添加图片域名
在 **downloadFile合法域名** 中添加：
```
https://dengserver-1257986780.cos.ap-beijing.myqcloud.com
```

### 步骤4：保存配置
- 点击"修改"按钮
- 输入小程序管理员的微信扫码验证
- 保存后等待几分钟生效

## 腾讯云COS配置（可选优化）

### 方式1：开启公有读权限
1. 登录腾讯云控制台
2. 进入对象存储 COS
3. 找到存储桶：dengserver-1257986780
4. 点击：权限管理 -> 公共权限
5. 设置为：**公有读私有写**

### 方式2：配置CDN加速（推荐）
1. 在存储桶中找到：域名与传输管理
2. 开启 **默认CDN加速域名**
3. 使用CDN域名替换原域名
4. CDN域名格式：`https://xxxxx.file.myqcloud.com`

## 验证配置是否成功

在小程序控制台执行：
```javascript
wx.downloadFile({
  url: 'https://dengserver-1257986780.cos.ap-beijing.myqcloud.com/2/img_2_20251017170742_.jpg',
  success: (res) => {
    console.log('✅ 下载成功:', res);
  },
  fail: (err) => {
    console.log('❌ 下载失败:', err);
  }
});
```

## 常见问题

### Q: 配置后仍然不显示？
A: 
1. 检查是否保存配置
2. 等待3-5分钟让配置生效
3. 重启微信开发者工具
4. 清除缓存后重试

### Q: 真机预览时不显示？
A: 必须在微信公众平台配置域名白名单，开发工具的设置对真机无效

### Q: 发布后仍然不显示？
A: 检查是否同时配置了以下域名：
- request合法域名（API接口）
- downloadFile合法域名（图片下载）
- uploadFile合法域名（图片上传）

## 当前项目需要配置的域名

根据代码分析，需要配置以下域名：

### request合法域名
```
你的API服务器域名（从 env.js 中获取）
```

### downloadFile合法域名
```
https://dengserver-1257986780.cos.ap-beijing.myqcloud.com
```

### uploadFile合法域名
```
https://dengserver-1257986780.cos.ap-beijing.myqcloud.com
```

