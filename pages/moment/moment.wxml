<view class="page">
	<!-- ä¸ªäººä¿¡æ¯å¤´éƒ¨å¡ç‰‡ -->
	<view class="profile-card">
	<!-- å¤šä¸ªå®å®ï¼šå°é¢è½®æ’­ -->
	<swiper 
		wx:if="{{babyList && babyList.length > 1}}"
		class="cover-swiper"
		current="{{currentBabyIndex}}"
		indicator-dots="{{true}}"
		indicator-color="rgba(255, 255, 255, 0.3)"
		indicator-active-color="#fff"
		circular="{{true}}"
		autoplay="{{swiperAutoplay}}"
		interval="{{swiperInterval}}"
		duration="{{swiperDuration}}"
		bindchange="onCoverSwiperChange"
	>
			<swiper-item wx:for="{{babyList}}" wx:key="id" wx:for-item="baby">
				<view class="cover-container" bindtap="goToBabyDetail" data-baby-id="{{baby.id}}">
					<t-image class="cover-image" src="{{baby.avatar}}" mode="aspectFill" shape="round" />
					<view class="overlay"></view>
				</view>
			</swiper-item>
		</swiper>
		<!-- å•ä¸ªå®å®æˆ–æ— æ•°æ®ï¼šå•å¼ å°é¢ -->
		<view wx:else class="cover-container" bindtap="{{babyList && babyList.length === 1 ? 'goToBabyDetail' : 'previewCoverImage'}}" data-baby-id="{{babyList && babyList.length === 1 ? babyList[0].id : ''}}">
			<t-image class="cover-image" src="{{coverImage}}" mode="aspectFill" shape="round" />
			<view class="overlay"></view>
		</view>
		
	<view class="user-info-container">
		<image class="user-avatar" src="{{userAvatar}}" mode="aspectFill" binderror="onAvatarError" bindload="onAvatarLoad" />
		<text class="user-nickname">{{userNickname}}</text>
	</view>
	<!-- å‘å¸ƒæŒ‰é’® -->
	<view class="publish-btn" bindtap="goToPublish" catchtap="goToPublish" hover-class="none">
		<view class="heart-shape">â¤</view>
	</view>
	</view>
	
	<!-- æœ‹å‹åœˆåŠ¨æ€åˆ—è¡¨ -->
	<view class="moments-container">
		<block wx:for="{{posts}}" wx:key="id" wx:for-item="post" wx:for-index="postIndex">
		<view class="moment-card">
			<view class="moment-header">
				<view class="user-section">
					<image class="moment-avatar" src="{{post.avatar}}" mode="aspectFill" />
					<view class="user-info">
						<text class="user-name">{{post.nick}}</text>
						<text class="post-time">{{post.time}}</text>
					</view>
				</view>
			</view>
				
			<view class="moment-content">
				<text class="content-text">{{post.text}}</text>
			</view>
			
			<!-- å›¾ç‰‡å±•ç¤ºåŒºåŸŸ -->
			<view class="moment-images" wx:if="{{post.images && post.images.length > 0}}">
				<image 
					wx:for="{{post.images}}" 
					wx:key="index" 
					wx:for-item="imageUrl" 
					wx:for-index="imgIndex"
					wx:if="{{imgIndex < 9}}"
					class="moment-image moment-image-grid" 
					src="{{imageUrl}}" 
					mode="aspectFill"
					bindtap="previewImage"
					data-urls="{{post.images}}"
					data-current="{{imageUrl}}"
				/>
			</view>
				
				<view class="moment-location" wx:if="{{post.loc}}">
					<t-icon name="location" size="24rpx" color="#0052d9" />
					<text class="location-text">{{post.loc}}</text>
				</view>
				
				<t-divider />
				
			<view class="moment-actions">
				<view wx:if="{{post.createUserId === currentUserId || isHouseholder}}" class="action-item action-item-horizontal action-item-delete" bindtap="onDelete" data-index="{{postIndex}}">
					<t-icon name="delete" size="36rpx" color="#ff4444" />
					<text class="action-text delete-text">åˆ é™¤</text>
				</view>
				<view class="action-item action-item-horizontal {{post.liked ? 'liked' : ''}}" bindtap="onLike" data-index="{{postIndex}}">
					<t-icon name="{{post.liked ? 'thumb-up-filled' : 'thumb-up'}}" size="36rpx" color="{{post.liked ? '#0052d9' : '#999'}}" />
					<text class="action-text {{post.liked ? 'active' : ''}}">{{post.likeCount > 0 ? post.likeCount : 'èµ'}}</text>
				</view>
				<view class="action-item action-item-horizontal" bindtap="onComment" data-index="{{postIndex}}">
					<t-icon name="chat" size="36rpx" color="#999" />
					<text class="action-text">{{post.commentCount > 0 ? post.commentCount : 'è¯„è®º'}}</text>
				</view>
			</view>

			<!-- è¯„è®ºé¢„è§ˆåŒºåŸŸ -->
			<view class="comment-preview" wx:if="{{post.previewComments && post.previewComments.length > 0}}">
				<view class="preview-comment-item" wx:for="{{post.previewComments}}" wx:key="id" wx:for-item="comment">
					<text class="preview-comment-role">{{comment.userRoleName || comment.userName}}ï¼š</text>
					<text class="preview-comment-content">
						<text wx:if="{{comment.parentUserName}}" class="preview-reply-to">å›å¤@{{comment.parentUserName}} </text>{{comment.commentContent}}
					</text>
				</view>
				<view class="more-comments" wx:if="{{post.commentCount > 3}}" bindtap="onComment" data-index="{{postIndex}}">
					<text class="more-comments-text">...</text>
				</view>
			</view>
			</view>
		</block>
		
		<!-- ç©ºçŠ¶æ€æç¤º -->
		<view class="empty-container" wx:if="{{posts.length === 0 && !authVisible}}">
			<t-empty 
				icon="info-circle" 
				description="è¿˜æ²¡æœ‰æœ‹å‹åœˆåŠ¨æ€"
			>
				<t-button slot="action" theme="primary" size="medium" bindtap="goToPublish">
					å‘å¸ƒç¬¬ä¸€æ¡åŠ¨æ€
				</t-button>
			</t-empty>
		</view>
	</view>

	<!-- ç™»å½•å¼¹çª— -->
	<view class="auth-mask" wx:if="{{authVisible}}" bindtap="closeAuth">
		<view class="auth-modal" catchtap="stopPropagation">
			<view class="brand">
				<t-image src="/assets/default.png" width="80" height="80" shape="round" />
				<text class="slogan">æ¬¢è¿ä½¿ç”¨ æˆé•¿æ—¥è®° å°ç¨‹åºï¼Œç™»å½•åå³å¯è®°å½•å®å®çš„ç¾å¥½æ—¶å…‰</text>
      </view>
			<view class="actions">
				<t-button wx:if="{{canIUseGetUserProfile}}" bindtap="onGetUserProfile">å¾®ä¿¡æˆæƒç™»å½•</t-button>
			</view>
		</view>
	</view>

	<!-- ç‚¹èµåŠ¨ç”» -->
	<view class="like-animation-container" wx:if="{{likeAnimVisible}}">
		<view class="like-animation {{likeAnimType}}" key="{{likeAnimKey}}">
			<view class="heart-icon" wx:if="{{likeAnimType === 'like'}}">â¤ï¸</view>
			<view class="heart-break-container" wx:if="{{likeAnimType === 'unlike'}}">
				<view class="heart-piece heart-piece-1">ğŸ’”</view>
				<view class="heart-piece heart-piece-2">ğŸ’”</view>
			</view>
		</view>
	</view>

	<!-- è¯„è®ºå¼¹çª— -->
	<view class="comment-mask" wx:if="{{commentVisible}}" bindtap="closeCommentDialog">
		<view class="comment-modal" catchtap="stopCommentPropagation">
			<!-- æ ‡é¢˜æ  -->
			<view class="comment-header">
				<text class="comment-title">è¯„è®º {{comments.length > 0 ? comments.length : ''}}</text>
				<t-icon name="close" size="40rpx" color="#666" bindtap="closeCommentDialog" />
			</view>

			<!-- è¯„è®ºåˆ—è¡¨ -->
			<scroll-view class="comment-list" scroll-y>
				<block wx:if="{{comments.length > 0}}">
					<view class="comment-item" wx:for="{{comments}}" wx:key="id">
						<view class="comment-user">
							<image class="comment-avatar" src="{{item.userAvatar || '/assets/default.png'}}" mode="aspectFill" />
							<view class="comment-info">
								<view class="comment-user-info">
									<text class="comment-username">{{item.userName}}</text>
									<text class="comment-role" wx:if="{{item.userRoleName}}">{{item.userRoleName}}</text>
								</view>
								<text class="comment-time">{{item.createTime}}</text>
							</view>
						</view>
						
						<view class="comment-content">
							<text wx:if="{{item.parentUserName}}" class="reply-to">å›å¤ @{{item.parentUserName}}ï¼š</text>
							<text>{{item.commentContent}}</text>
						</view>

						<view class="comment-actions">
							<text class="comment-action-btn" bindtap="onReplyComment" data-comment-id="{{item.id}}" data-user-name="{{item.userName}}">å›å¤</text>
							<text class="comment-action-btn delete" wx:if="{{item.userId === userInfo.id}}" bindtap="onDeleteComment" data-comment-id="{{item.id}}">åˆ é™¤</text>
						</view>
					</view>
				</block>
				<view class="comment-empty" wx:else>
					<t-icon name="chat" size="80rpx" color="#e0e0e0" />
					<text class="empty-text">æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§~</text>
				</view>
			</scroll-view>

			<!-- å›å¤æç¤º -->
			<view class="reply-hint" wx:if="{{replyToUserName}}">
				<text class="reply-hint-text">å›å¤ @{{replyToUserName}}</text>
				<t-icon name="close" size="32rpx" color="#999" bindtap="onCancelReply" />
			</view>

			<!-- è¾“å…¥æ¡† -->
			<view class="comment-input-wrapper">
				<input 
					class="comment-input" 
					placeholder="{{replyToUserName ? 'å›å¤ @' + replyToUserName : 'è¯´ç‚¹ä»€ä¹ˆå§...'}}"
					value="{{commentInput}}"
					bindinput="onCommentInput"
					focus="{{inputFocus}}"
					confirm-type="send"
					bindconfirm="onSubmitComment"
				/>
				<view class="comment-send-btn {{commentInput ? 'active' : ''}}" bindtap="onSubmitComment">
					å‘é€
				</view>
			</view>
		</view>
	</view>
</view>
